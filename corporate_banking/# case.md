## Глоссарий
| Термин                          | Определение                                                                                              |
| ------------------------------- | -------------------------------------------------------------------------------------------------------- |
| Клиент                          | юридическое лицо (ЮЛ)                                                                                    |
| Связанное физическое лицо (СФЛ) | представитель ЮЛ.                                                                                        |
| Кооперация                      | группа ЮЛ, которые действуют на выполнение общей задачи. Пример: несколько организаций строят жилой дом. |
| Транзакционная система          | "АС1". В которой отражаются транзакции по счетам Клиентов.                                               |
| Фабрика данных                  | "АС2". В которую должны отгружаться данные из основных АС банка. Используется для отчетов.               |
| Продуктовая фабрика             | "АС3". Должна хранить полномочия СФЛ.                                                                    |
| Интернет-банк                   | "АС4". Клиентское web-приложение (личный кабинет Клиента), в которое необходимо вывести информацию.      |

## Декомпозиция задачи
### Epic
E-0: Отчеты клиентов.

### Feature
F-0: Дашборд по счетам кооперации.

### User Stories
- US-0: Дашборд по счету ЮЛ.  
Как Связанное Физическое Лицо,  
я хочу просматривать агрегированную информацию (дашборд) по транзакциям рассчетных счетов своей организации,  
чтобы действовать на выполнение задач своей организации.  
**Вопросы и примечания:**  
  - Как будут использоваться данные из дашборда?
  - За какой период нужны данные?
  - По каким полям нужно группировать данные?
  - Счета-исключения нужы?
  - Нужно ли подгружать данные онлайн из АС1, если данные в АС2 устарели?

- US-1: Права СФЛ на кооперацию.  
Как сотрудник банка,  
я хочу вводить информацию о полномочиях СФЛ на просмотр данных по кооперациям,  
чтобы СФЛ мог действовать на выполнение общей задачи кооперации.  
**Вопросы и примечания:**  
- Полномочия СФЛ ограничены по времени?

- US-2: Дашборд по счетам доступных СФЛ коопераций.  
Как Связанное Физическое Лицо,  
я хочу просматривать дашборд по рассчетным счетам доступных коопераций,  
чтобы действовать на выполнение общей задачи кооперации.

## Логическая модель данных
```mermaid
erDiagram
legal_entity {int legal_entity_id PK}
representer {
int representer_id PK
int legal_entity_id FK
int individual_id FK
}
bank_account {
int bank_account_id PK
}
cooperation {
int cooperation_id PK
int legal_entity_id FK "Владелец"
}
cooperation_members {
int cooperation_id FK
int legal_entity_id FK "Член кооперации"
}
representer_credentials {
int representer_credentials_id PK
int representer_id FK
int cooperation_id FK
}
individual {
int individual_id FK
}

legal_entity ||--o{ representer : "назначает представителя"
bank_account }|--|| legal_entity : "владеет"
cooperation  }o--|| legal_entity : "возглавляет" 
cooperation ||--|{ cooperation_members : "объединяет"
legal_entity ||--|{ cooperation_members : "входит"
representer ||--|{ representer_credentials : "получает полномочия"
representer_credentials }|--|| cooperation : "предоставляет полномочия"
representer }o--|| individual : "представляет ЮЛ"
```
## Диаграмма последовательности
```mermaid
---
title: Сервис "Дашборд по счетам кооперации"
---
sequenceDiagram
actor СФЛ
participant АС4 as Интернет-банк (АС4)
participant АС3 as Продуктовая фабрика (АС3)
participant АС2 as Фабрика данных (АС2)

participant АС1 as Транзакционная (АС1)

loop
АС1->>АС2:реплицировать данные транзакций
end 

autonumber
СФЛ->>АС4: авторизоваться(логин, пароль, код доступа)

alt успех
АС4-->>СФЛ: авторизован
else ошибка
АС4-->>СФЛ: не авторизован(текст ошибки)
end


СФЛ->>АС4: открыть дашборд по счетам кооперации (идентификатор СДЛ)
АС4->>АС3: определить права доступа(идентификатор СДЛ)

alt есть права на 1 кооперацию и более
АС3-->>АС4: права на просмотр данных кооперации
АС4-->>СФЛ: права на просмотр данных кооперации
else нет прав ни на одну кооперацию

АС3-->>АС4: нет права на просмотр данных кооперации
АС4-->>СФЛ: нет права на просмотр данных кооперации
end 


СФЛ-)АС4: просмотреть дашборд
АС4-)АС2: запросить данные для дашборда
alt данные есть
АС2--)АС4: передать данные для дашборда
АС4--)СФЛ: отобразить данные в дашборде
else данные устарели, данных нет

АС2--)АС4: данные требуется обновить 
АС4--)СФЛ: "идет обновление данных"
АС2-)АС1: запросить репликацию данных конкретной кооперации
note right of АС1: возможно дорогая операция. Обсудить целесообразность.
АС1--)АС2: реплицировать данные транзакций конкретной кооперации
АС2--)АС4: передать данные для дашборда
АС4--)СФЛ: отобразить данные в дашборде
end
```